unit Ativacao;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, Vcl.ExtCtrls, Vcl.StdCtrls, Vcl.Buttons,
  Vcl.Imaging.jpeg, ShellAPI;

type
  TFrmAtivacao = class(TForm)
    btnregistrar: TSpeedButton;
    btnTestar: TSpeedButton;
    btncomprar: TSpeedButton;
    edtSeriallicenca: TEdit;
    Label2: TLabel;
    Panel1: TPanel;
    Image1: TImage;
    Image2: TImage;
    Label3: TLabel;
    Label4: TLabel;
    edtID: TEdit;
    btnSair: TButton;

  procedure FormShow(Sender: TObject);
    procedure btnregistrarClick(Sender: TObject);
    procedure btncomprarClick(Sender: TObject);
    procedure btnSairClick(Sender: TObject);
  private
    { Private declarations }
    procedure associarCampos;

  public
    { Public declarations }
  end;

var
  FrmAtivacao: TFrmAtivacao;

implementation

{$R *.dfm}

uses Modulo, Login;











procedure TFrmAtivacao.associarCampos;
begin
 dm.tb_registro.FieldByName('numero').Value := numeroInstalacao;
 dm.tb_registro.FieldByName('serialkey').Value := edtSeriallicenca.Text;
end;

procedure TFrmAtivacao.FormShow(Sender: TObject);
  var
  Num, Num2: Byte;
  a, a2 : integer;
   function GetRandomPassword(Size: Integer; Tipo : Integer = 1): String;
              var
                I: Integer;
                Chave: String;
              const
                str1 = '1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
                str2 = '1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                str3 = '1234567890abcdefghijklmnopqrstuvwxyz';
                str4 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
                str5 = '1234567890';
                str6 = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                str7 = 'abcdefghijklmnopqrstuvwxyz';
               begin
                dm.tb_registro.Active := true;
                dm.tb_registro.insert;

                Chave := '';

                for I := 1 to Size do
                begin
                  case Tipo of
                    1 : Chave := Chave + str1[Random(Length(str1)) + 1];
                    2 : Chave := Chave + str2[Random(Length(str2)) + 1];
                    3 : Chave := Chave + str3[Random(Length(str3)) + 1];
                    4 : Chave := Chave + str4[Random(Length(str4)) + 1];
                    5 : Chave := Chave + str5[Random(Length(str5)) + 1];
                    6 : Chave := Chave + str6[Random(Length(str6)) + 1];
                    7 : Chave := Chave + str7[Random(Length(str7)) + 1];
                  end;
                end;

                Result := Chave;

              end;


 begin
       dm.query_registro.Close;
       dm.query_registro.SQL.Clear;
       dm.query_registro.SQL.Add('SELECT * from registro');
       dm.query_registro.Open;
     {if chamada = 'serialinvalido' then
     begin
     numeroInstalacao := dm.query_registro.FieldByName('numero').Value;
     end; }

        if dm.query_registro.isEmpty then
         begin
                Randomize;
                for a := 1 to 10000 do
                  begin
                    Num := Random(10000);
                     //edit7.Text := (IntToStr(Num));
                    //Memo1.Lines.Add(IntToStr(Num));
                  end;

                 Randomize;
                for a := 1000 to 2000 do
                  begin
                    Num2 := Random(2000);
                     //editSeriallicenca.Text := (IntToStr(Num2));
                    //Memo1.Lines.Add(IntToStr(Num));
                  end;

                  edtID.Text := IntToStr(Num) +  IntToStr(Num2) + GetRandomPassword(12, 5);
                  numeroInstalacao := edtID.Text;
                  associarCampos;
                  dm.tb_registro.Post;


          end
          else
          begin
          edtID.Text := dm.query_registro.FieldByName('numero').Value;

          end;






 end;
procedure TFrmAtivacao.btnSairClick(Sender: TObject);
begin
Application.Terminate;
end;

procedure TFrmAtivacao.btncomprarClick(Sender: TObject);
begin
ShellExecute(Handle,'open','http://www.globo.com','','',1);
end;

procedure TFrmAtivacao.btnregistrarClick(Sender: TObject);
begin
 //calculo de serial e guardar registro



end;

end.
